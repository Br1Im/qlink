# üöÄ –î–µ–ø–ª–æ–π –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ

```bash
cd /var/www  # –∏–ª–∏ –≤–∞—à–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
git clone <your-repo-url> qlink
cd qlink
```

### 2. –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª

```bash
cat > .env << 'EOF'
# Database
DATABASE_URL="postgresql://postgres:password@postgres:5432/qlink"

# JWT
JWT_SECRET="your-super-secret-key-change-this-in-production"

# Ports
API_PORT=4000
PORT=3000

# URLs
FRONTEND_URL=http://your-domain.com
NEXT_PUBLIC_API_URL=http://your-domain.com:4000

# Optional (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º–∏)
BOT_TOKEN=
SMTP_HOST=
SMTP_PORT=
SMTP_USER=
SMTP_PASS=
SMTP_FROM=
SMS_API_KEY=
SMS_API_URL=
YOOKASSA_SHOP_ID=
YOOKASSA_SECRET_KEY=
STRIPE_SECRET_KEY=
STRIPE_PUBLISHABLE_KEY=
EOF
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ Docker Compose

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down -v

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å—ë
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker-compose ps

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker-compose logs -f
```

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

```bash
# –í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä backend
docker exec -it qlink-backend sh

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
cd packages/backend
npx prisma migrate deploy

# –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
npx prisma db seed

# –í—ã–π—Ç–∏
exit
```

### 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
- Frontend: http://your-domain.com:3001
- Backend API: http://your-domain.com:4000
- Health check: http://your-domain.com:4000/health

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### 1. –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx

```bash
sudo nano /etc/nginx/sites-available/qlink
```

–í—Å—Ç–∞–≤–∏—Ç—å:

```nginx
server {
    listen 80;
    server_name your-domain.com;

    # Frontend
    location / {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Backend API
    location /api {
        proxy_pass http://localhost:4000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Health check
    location /health {
        proxy_pass http://localhost:4000/health;
    }
}
```

### 2. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

```bash
sudo ln -s /etc/nginx/sites-available/qlink /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSL (Let's Encrypt)

```bash
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
docker-compose ps
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏

```bash
# –í—Å–µ –ª–æ–≥–∏
docker-compose logs -f

# –¢–æ–ª—å–∫–æ backend
docker-compose logs -f backend

# –¢–æ–ª—å–∫–æ frontend
docker-compose logs -f frontend

# –¢–æ–ª—å–∫–æ postgres
docker-compose logs -f postgres
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

```bash
docker stats
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# 1. –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd /var/www/qlink

# 2. –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull origin main

# 3. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose down
docker-compose build --no-cache
docker-compose up -d

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å –Ω–æ–≤—ã–µ)
docker exec -it qlink-backend sh
cd packages/backend
npx prisma migrate deploy
exit
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down -v
docker-compose up -d --force-recreate
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ postgres –∑–∞–ø—É—â–µ–Ω
docker-compose ps postgres

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ postgres
docker-compose logs postgres

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å postgres
docker-compose restart postgres
```

### Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "Backend API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω
docker-compose ps backend

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ backend
docker-compose logs backend

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker exec qlink-backend env | grep API_URL
```

### –ü–æ—Ä—Ç—ã –∑–∞–Ω—è—Ç—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∫–∏–µ –ø–æ—Ä—Ç—ã –∑–∞–Ω—è—Ç—ã
netstat -tulpn | grep -E ':(3000|3001|4000|5432|6379)'

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–∞ –ø–æ—Ä—Ç–∞—Ö
sudo lsof -ti:3001 | xargs kill -9
sudo lsof -ti:4000 | xargs kill -9
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 1. –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª–∏ –ë–î

–í `.env` —Ñ–∞–π–ª–µ –∏–∑–º–µ–Ω–∏—Ç–µ:
```
DATABASE_URL="postgresql://postgres:NEW_STRONG_PASSWORD@postgres:5432/qlink"
```

–í `docker-compose.yml` –∏–∑–º–µ–Ω–∏—Ç–µ:
```yaml
postgres:
  environment:
    POSTGRES_PASSWORD: NEW_STRONG_PASSWORD
```

### 2. –ò–∑–º–µ–Ω–∏—Ç—å JWT_SECRET

```bash
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π –∫–ª—é—á
openssl rand -base64 32

# –í—Å—Ç–∞–≤–∏—Ç—å –≤ .env
JWT_SECRET="generated-key-here"
```

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å firewall

```bash
# –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 22/tcp
sudo ufw enable
```

### 4. –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã –ë–î

```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –±—ç–∫–∞–ø–∞
cat > /root/backup-qlink.sh << 'EOF'
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
docker exec qlink-postgres pg_dump -U postgres qlink > /backups/qlink_$DATE.sql
# –£–¥–∞–ª–∏—Ç—å –±—ç–∫–∞–ø—ã —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π
find /backups -name "qlink_*.sql" -mtime +7 -delete
EOF

chmod +x /root/backup-qlink.sh

# –î–æ–±–∞–≤–∏—Ç—å –≤ cron (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00)
echo "0 3 * * * /root/backup-qlink.sh" | sudo crontab -
```

## üìà –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 1. –£–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç—ã –¥–ª—è PostgreSQL

–í `docker-compose.yml`:
```yaml
postgres:
  command: postgres -c max_connections=200 -c shared_buffers=256MB
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

Redis —É–∂–µ –≤–∫–ª—é—á–µ–Ω –≤ docker-compose.yml –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

### 3. –í–∫–ª—é—á–∏—Ç—å gzip –≤ Nginx

–í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx –¥–æ–±–∞–≤–∏—Ç—å:
```nginx
gzip on;
gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
```

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –¥–µ–ø–ª–æ—è

- [ ] –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- [ ] –°–æ–∑–¥–∞–Ω .env —Ñ–∞–π–ª —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- [ ] –ò–∑–º–µ–Ω–µ–Ω—ã –ø–∞—Ä–æ–ª–∏ –ë–î
- [ ] –ò–∑–º–µ–Ω–µ–Ω JWT_SECRET
- [ ] –ó–∞–ø—É—â–µ–Ω—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —á–µ—Ä–µ–∑ docker-compose
- [ ] –í—ã–ø–æ–ª–Ω–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω Nginx
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω firewall
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –±—ç–∫–∞–ø—ã –ë–î
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏

## üéâ –ì–æ—Ç–æ–≤–æ!

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: https://your-domain.com
